<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸¬è©¦å‹•æ…‹è©•åˆ†ç³»çµ±</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .form-control {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-bottom: 1rem;
        }
        .rating-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }
        .rating-item {
            text-align: center;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .rating-label {
            font-weight: bold;
            color: #333;
            margin-bottom: 0.5rem;
            display: block;
        }
        .rating-description {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 1rem;
            font-style: italic;
        }
        .rating-stars {
            display: flex;
            gap: 0.25rem;
            font-size: 1.5rem;
            margin: 0.5rem 0;
            justify-content: center;
        }
        .rating-star {
            cursor: pointer;
            transition: all 0.2s ease;
            color: #ddd;
        }
        .rating-star.active,
        .rating-star:hover {
            color: #B8860B;
            transform: scale(1.1);
        }
        .rating-star.musical-note::before {
            content: 'â™ª';
        }
        .rating-star.musical-note.active::before {
            content: 'â™«';
        }
        .rating-placeholder {
            padding: 2rem;
            text-align: center;
            background: rgba(184, 134, 11, 0.05);
            border-radius: 8px;
            border: 2px dashed rgba(184, 134, 11, 0.3);
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ» å‹•æ…‹è©•åˆ†ç³»çµ±æ¸¬è©¦</h1>
        
        <div>
            <label for="focus">ç·´ç¿’é‡é»ï¼š</label>
            <select class="form-control" id="focus" name="focus">
                <option value="technique">æŠ€å·§ç·´ç¿’</option>
                <option value="expression">è¡¨ç¾åŠ›</option>
                <option value="rhythm">ç¯€å¥</option>
                <option value="sight_reading">è¦–å¥</option>
                <option value="memorization">è¨˜è­œ</option>
                <option value="ensemble">é‡å¥</option>
                <option value="other">å…¶ä»–</option>
            </select>
        </div>
        
        <div id="dynamic-rating-section" class="rating-section">
            <div class="rating-placeholder">
                <p>è«‹é¸æ“‡ç·´ç¿’é‡é»</p>
            </div>
        </div>
        
        <div id="debug-info" style="background: #f0f0f0; padding: 1rem; border-radius: 4px; margin-top: 2rem;">
            <h3>èª¿è©¦ä¿¡æ¯ï¼š</h3>
            <div id="debug-output"></div>
        </div>
    </div>

    <script>
        // ç·´ç¿’é‡é»è©•åˆ†é…ç½®
        const FOCUS_RATING_CONFIG = {
            'technique': {
                'name': 'æŠ€å·§ç·´ç¿’',
                'ratings': [
                    ['technique_bow_control', 'é‹å¼“æ§åˆ¶', 'é‹å¼“æŠ€å·§å’Œæ§åˆ¶åŠ›'],
                    ['technique_finger_position', 'æŒ‰å¼¦æº–ç¢ºåº¦', 'å·¦æ‰‹æŒ‰å¼¦ä½ç½®æº–ç¢ºæ€§'],
                    ['technique_intonation', 'éŸ³æº–', 'éŸ³é«˜æº–ç¢ºåº¦'],
                ]
            },
            'expression': {
                'name': 'è¡¨ç¾åŠ›',
                'ratings': [
                    ['expression_dynamics', 'åŠ›åº¦è®ŠåŒ–', 'éŸ³é‡å¼·å¼±çš„è¡¨ç¾æ§åˆ¶'],
                    ['expression_phrasing', 'æ¨‚å¥è™•ç†', 'éŸ³æ¨‚ç·šæ¢èˆ‡æ¨‚å¥è¡¨ç¾'],
                    ['expression_emotion', 'æƒ…æ„Ÿè¡¨é”', 'éŸ³æ¨‚æƒ…æ„Ÿçš„å‚³é”'],
                ]
            },
            'rhythm': {
                'name': 'ç¯€å¥',
                'ratings': [
                    ['rhythm_tempo_stability', 'é€Ÿåº¦ç©©å®šåº¦', 'ç¯€æ‹é€Ÿåº¦ä¿æŒç©©å®š'],
                    ['rhythm_pattern_accuracy', 'ç¯€å¥å‹æº–ç¢ºåº¦', 'è¤‡é›œç¯€å¥å‹çš„æº–ç¢ºæ¼”å¥'],
                    ['technique_intonation', 'éŸ³æº–é…åˆ', 'ç¯€å¥ä¸­çš„éŸ³æº–ç¶­æŒ'],
                ]
            },
            'sight_reading': {
                'name': 'è¦–å¥',
                'ratings': [
                    ['sight_reading_fluency', 'è¦–å¥æµæš¢åº¦', 'ç¬¬ä¸€æ¬¡çœ‹è­œæ¼”å¥çš„æµæš¢ç¨‹åº¦'],
                    ['sight_reading_accuracy', 'è¦–å¥æº–ç¢ºåº¦', 'éŸ³ç¬¦ã€ç¯€å¥è®€è­œæº–ç¢ºåº¦'],
                    ['rhythm_tempo_stability', 'é€Ÿåº¦æ§åˆ¶', 'è¦–å¥æ™‚çš„é€Ÿåº¦ç©©å®šæ€§'],
                ]
            },
            'memorization': {
                'name': 'è¨˜è­œ',
                'ratings': [
                    ['memorization_stability', 'è¨˜æ†¶ç©©å®šåº¦', 'èƒŒè­œæ¼”å¥çš„ç©©å®šç¨‹åº¦'],
                    ['memorization_confidence', 'è¨˜è­œä¿¡å¿ƒ', 'èƒŒè­œæ¼”å¥çš„è‡ªä¿¡ç¨‹åº¦'],
                    ['technique_intonation', 'éŸ³æº–ç©©å®š', 'èƒŒè­œæ™‚çš„éŸ³æº–ç¶­æŒ'],
                ]
            },
            'ensemble': {
                'name': 'é‡å¥',
                'ratings': [
                    ['ensemble_listening', 'è†è½é…åˆ', 'èˆ‡å…¶ä»–è²éƒ¨çš„è†è½é…åˆ'],
                    ['ensemble_timing', 'æ™‚é–“åŒæ­¥', 'èˆ‡å…¶ä»–æ¨‚å™¨çš„æ™‚é–“åŒæ­¥'],
                    ['expression_dynamics', 'éŸ³é‡å¹³è¡¡', 'åœ¨åˆå¥ä¸­çš„éŸ³é‡æ§åˆ¶'],
                ]
            },
            'other': {
                'name': 'å…¶ä»–',
                'ratings': [
                    ['technique_bow_control', 'æŠ€å·§è¡¨ç¾', 'æ•´é«”æŠ€å·§å±•ç¾'],
                    ['expression_emotion', 'éŸ³æ¨‚è¡¨ç¾', 'æ•´é«”éŸ³æ¨‚æ€§è¡¨ç¾'],
                    ['rhythm_tempo_stability', 'ç©©å®šåº¦', 'æ•´é«”æ¼”å¥ç©©å®šæ€§'],
                ]
            }
        };

        function debug(message) {
            const debugOutput = document.getElementById('debug-output');
            const time = new Date().toLocaleTimeString();
            debugOutput.innerHTML += `<div>[${time}] ${message}</div>`;
            console.log(message);
        }

        function initDynamicRatingSystem() {
            const focusSelect = document.getElementById('focus');
            
            if (!focusSelect) {
                debug('éŒ¯èª¤ï¼šç·´ç¿’é‡é»é¸æ“‡å™¨æœªæ‰¾åˆ°ï¼');
                return;
            }
            
            debug(`åˆå§‹åŒ–å‹•æ…‹è©•åˆ†ç³»çµ±ï¼Œç•¶å‰é¸é …: ${focusSelect.value}`);
            
            // ç›£è½ç·´ç¿’é‡é»è®ŠåŒ–
            focusSelect.addEventListener('change', function() {
                debug(`ç·´ç¿’é‡é»å·²è®Šæ›´ç‚º: ${this.value}`);
                updateRatingSection(this.value);
            });
            
            // åˆå§‹åŒ–é è¨­è©•åˆ†å€å¡Š
            updateRatingSection(focusSelect.value);
        }

        function updateRatingSection(focusType) {
            const ratingSection = document.getElementById('dynamic-rating-section');
            
            if (!ratingSection) {
                debug('éŒ¯èª¤ï¼šè©•åˆ†å€åŸŸå…ƒç´ æœªæ‰¾åˆ°');
                return;
            }
            
            debug(`æ›´æ–°è©•åˆ†å€å¡Šï¼Œé¡å‹: ${focusType}`);
            
            if (!FOCUS_RATING_CONFIG[focusType]) {
                debug(`éŒ¯èª¤ï¼šæ‰¾ä¸åˆ°é…ç½® ${focusType}`);
                ratingSection.innerHTML = '<div class="rating-placeholder"><p>æ‰¾ä¸åˆ°å°æ‡‰çš„è©•åˆ†é…ç½®</p></div>';
                return;
            }
            
            const config = FOCUS_RATING_CONFIG[focusType];
            debug(`æ‰¾åˆ°é…ç½®: ${config.name}ï¼ŒåŒ…å« ${config.ratings.length} å€‹è©•åˆ†é …ç›®`);
            
            let html = '';
            
            config.ratings.forEach(([fieldName, displayName, description]) => {
                html += `
                    <div class="rating-item">
                        <label class="rating-label">${displayName}</label>
                        <p class="rating-description">${description}</p>
                        <div class="rating-stars" data-field="${fieldName}">
                            <span class="rating-star musical-note" data-value="1"></span>
                            <span class="rating-star musical-note" data-value="2"></span>
                            <span class="rating-star musical-note" data-value="3"></span>
                            <span class="rating-star musical-note" data-value="4"></span>
                            <span class="rating-star musical-note" data-value="5"></span>
                        </div>
                        <input type="hidden" name="${fieldName}" value="3">
                    </div>
                `;
            });
            
            ratingSection.innerHTML = html;
            debug(`è©•åˆ†HTMLå·²æ›´æ–°ï¼ŒåŒ…å« ${config.ratings.length} å€‹è©•åˆ†é …ç›®`);
            
            // é‡æ–°åˆå§‹åŒ–æ˜Ÿç´šè©•åˆ†
            initRatingStars();
        }

        function initRatingStars() {
            debug('åˆå§‹åŒ–æ˜Ÿç´šè©•åˆ†ç³»çµ±');
            
            document.querySelectorAll('.rating-stars').forEach(ratingContainer => {
                const stars = ratingContainer.querySelectorAll('.rating-star');
                const hiddenInput = ratingContainer.parentElement.querySelector('input[type="hidden"]');
                const currentRating = parseInt(hiddenInput.value);
                
                // è¨­ç½®åˆå§‹è©•åˆ†é¡¯ç¤º
                updateStarDisplay(stars, currentRating);
                
                stars.forEach((star, index) => {
                    star.addEventListener('click', function() {
                        const rating = parseInt(this.dataset.value);
                        hiddenInput.value = rating;
                        updateStarDisplay(stars, rating);
                        debug(`è©•åˆ†å·²æ›´æ–°: ${hiddenInput.name} = ${rating}`);
                    });
                    
                    star.addEventListener('mouseenter', function() {
                        const rating = parseInt(this.dataset.value);
                        updateStarDisplay(stars, rating);
                    });
                });
                
                ratingContainer.addEventListener('mouseleave', function() {
                    const currentRating = parseInt(hiddenInput.value);
                    updateStarDisplay(stars, currentRating);
                });
            });
        }

        function updateStarDisplay(stars, rating) {
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
        }

        // é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            debug('é é¢è¼‰å…¥å®Œæˆï¼Œé–‹å§‹åˆå§‹åŒ–');
            initDynamicRatingSystem();
        });
    </script>
</body>
</html>