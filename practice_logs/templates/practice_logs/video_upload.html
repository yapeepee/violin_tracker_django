{% extends "practice_logs/base.html" %}
{% load static %}

{% block title %}ä¸Šå‚³ç·´ç¿’å½±ç‰‡{% endblock %}

{% block extra_css %}
<style>
.video-upload-container {
    max-width: 900px;
    margin: 40px auto;
    padding: 0 20px;
}

.upload-card {
    background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(248,249,250,0.95));
    border-radius: 20px;
    padding: 40px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    border: 1px solid rgba(139, 69, 19, 0.1);
    position: relative;
    overflow: hidden;
}

.upload-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #8b4513, #d4a574, #8b4513);
}

.upload-header {
    text-align: center;
    margin-bottom: 40px;
    padding-bottom: 20px;
    border-bottom: 2px solid #e9ecef;
}

.upload-header h1 {
    color: #2c3e50;
    font-weight: 600;
    margin-bottom: 10px;
    font-family: 'Georgia', serif;
}

.upload-header p {
    color: #6c757d;
    font-size: 1.1rem;
}

.upload-icon {
    font-size: 3rem;
    color: #8b4513;
    margin-bottom: 20px;
    animation: gentle-pulse 2s ease-in-out infinite;
}

@keyframes gentle-pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}

.form-group {
    margin-bottom: 25px;
    position: relative;
}

.form-label {
    font-weight: 500;
    color: #2c3e50;
    margin-bottom: 8px;
    display: block;
}

.form-control {
    width: 100%;
    border: 2px solid #e9ecef;
    border-radius: 10px;
    padding: 12px 16px;
    transition: all 0.3s ease;
    background: rgba(255, 255, 255, 0.9);
    font-size: 1rem;
}

.form-control:focus {
    border-color: #8b4513;
    box-shadow: 0 0 0 0.2rem rgba(139, 69, 19, 0.25);
    outline: none;
    background: white;
}

.file-upload-area {
    border: 3px dashed #8b4513;
    border-radius: 15px;
    padding: 40px 20px;
    text-align: center;
    background: rgba(255, 255, 255, 0.8);
    transition: all 0.3s ease;
    cursor: pointer;
    position: relative;
}

.file-upload-area:hover {
    border-color: #d4a574;
    background: rgba(139, 69, 19, 0.05);
}

.file-upload-area.dragover {
    border-color: #8b4513;
    background: rgba(139, 69, 19, 0.1);
    transform: scale(1.02);
}

.file-upload-content {
    pointer-events: none;
}

.file-upload-icon {
    font-size: 3rem;
    color: #8b4513;
    margin-bottom: 15px;
}

.file-upload-text {
    font-size: 1.2rem;
    color: #2c3e50;
    margin-bottom: 10px;
}

.file-upload-hint {
    color: #6c757d;
    font-size: 0.9rem;
}

.hidden-file-input {
    display: none;
}

.selected-file {
    margin-top: 15px;
    padding: 10px 15px;
    background: rgba(40, 167, 69, 0.1);
    border: 1px solid rgba(40, 167, 69, 0.3);
    border-radius: 8px;
    color: #155724;
}

.rating-container {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-top: 8px;
}

.star-rating {
    display: flex;
    gap: 5px;
}

.star {
    font-size: 1.8rem;
    color: #ddd;
    cursor: pointer;
    transition: color 0.2s ease, transform 0.2s ease;
}

.star.active,
.star:hover {
    color: #ffc107;
    transform: scale(1.1);
}

.rating-display {
    font-weight: 500;
    color: #2c3e50;
    font-size: 1.1rem;
}

.privacy-options {
    display: grid;
    grid-template-columns: 1fr;
    gap: 15px;
    margin-top: 10px;
}

.privacy-option {
    position: relative;
}

.privacy-option input[type="radio"] {
    display: none;
}

.privacy-label {
    display: flex;
    align-items: center;
    padding: 15px 20px;
    border: 2px solid #e9ecef;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    background: rgba(255, 255, 255, 0.9);
    gap: 15px;
}

.privacy-label:hover {
    border-color: #8b4513;
    background: rgba(139, 69, 19, 0.05);
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(139, 69, 19, 0.15);
}

.privacy-option input[type="radio"]:checked + .privacy-label {
    border-color: #8b4513;
    background: linear-gradient(135deg, rgba(139, 69, 19, 0.1), rgba(212, 165, 116, 0.1));
    box-shadow: 0 4px 15px rgba(139, 69, 19, 0.2);
}

.privacy-icon {
    font-size: 2rem;
    flex-shrink: 0;
}

.privacy-info {
    flex: 1;
}

.privacy-title {
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 4px;
    font-size: 1.1rem;
}

.privacy-desc {
    color: #6c757d;
    font-size: 0.9rem;
    line-height: 1.4;
}

.progress-container {
    margin-top: 20px;
    display: none;
}

.progress-bar {
    width: 100%;
    height: 20px;
    background: #e9ecef;
    border-radius: 10px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(45deg, #8b4513, #d4a574);
    border-radius: 10px;
    transition: width 0.3s ease;
    width: 0%;
}

.btn-upload {
    background: linear-gradient(45deg, #8b4513, #d4a574);
    border: none;
    color: white;
    padding: 15px 40px;
    border-radius: 10px;
    font-weight: 600;
    font-size: 1.1rem;
    cursor: pointer;
    transition: all 0.3s ease;
    display: block;
    margin: 30px auto 0;
    min-width: 200px;
}

.btn-upload:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(139, 69, 19, 0.3);
    color: white;
}

.btn-upload:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
}

.upload-tips {
    background: rgba(255, 193, 7, 0.1);
    border: 1px solid rgba(255, 193, 7, 0.3);
    border-radius: 10px;
    padding: 20px;
    margin-top: 30px;
}

.upload-tips h5 {
    color: #856404;
    margin-bottom: 15px;
}

.upload-tips ul {
    color: #856404;
    margin-bottom: 0;
}

.alert {
    border-radius: 10px;
    border: none;
    margin-bottom: 20px;
}

.alert-success {
    background: linear-gradient(45deg, #d4edda, #c3e6cb);
    color: #155724;
}

.alert-danger {
    background: linear-gradient(45deg, #f8d7da, #f1b0b7);
    color: #721c24;
}

/* éŸ¿æ‡‰å¼è¨­è¨ˆ */
@media (max-width: 768px) {
    .video-upload-container {
        margin: 20px auto;
        padding: 0 15px;
    }
    
    .upload-card {
        padding: 30px 20px;
    }
    
    .file-upload-area {
        padding: 30px 15px;
    }
    
    .rating-container {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="video-upload-container">
    <!-- éŒ¯èª¤/æˆåŠŸæç¤ºå€åŸŸ -->
    <div id="alertContainer"></div>

    <div class="upload-card">
        <div class="upload-header">
            <div class="upload-icon">ğŸ¥</div>
            <h1>ä¸Šå‚³ç·´ç¿’å½±ç‰‡</h1>
            <p>åˆ†äº«æ‚¨çš„æ¼”å¥è¨˜éŒ„ï¼Œè¿½è¹¤é€²æ­¥è»Œè·¡</p>
        </div>

        <form id="videoUploadForm" enctype="multipart/form-data">
            {% csrf_token %}
            
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="studentName" class="form-label">å­¸ç”Ÿå§“å *</label>
                        <input type="text" 
                               name="student_name" 
                               id="studentName" 
                               class="form-control" 
                               placeholder="è«‹è¼¸å…¥å­¸ç”Ÿå§“å" 
                               required
                               value="{{ student_name|default:'' }}" 
                               maxlength="50">
                        <div class="form-text">æ¼”å¥è€…çš„å§“å</div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="recordingDate" class="form-label">éŒ„éŸ³æ—¥æœŸ *</label>
                        <input type="date" 
                               name="recording_date" 
                               id="recordingDate" 
                               class="form-control" 
                               required>
                        <div class="form-text">éŒ„è£½é€™å€‹å½±ç‰‡çš„æ—¥æœŸ</div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="piece" class="form-label">æ¼”å¥æ›²ç›® *</label>
                <input type="text" 
                       name="piece" 
                       id="piece"
                       class="form-control" 
                       placeholder="ä¾‹å¦‚ï¼šå·´å“ˆç„¡ä¼´å¥å°æç´çµ„æ›²ç¬¬ä¸€è™Ÿ Allemande" 
                       required 
                       maxlength="200"
                       list="piecesList">
                <datalist id="piecesList">
                    {% for piece in pieces %}
                        <option value="{{ piece }}">
                    {% endfor %}
                </datalist>
                <div class="form-text">æ‚¨æ¼”å¥çš„æ¨‚æ›²åç¨±</div>
            </div>

            <div class="form-group">
                <label class="form-label">å½±ç‰‡æª”æ¡ˆ *</label>
                <div class="file-upload-area" id="fileUploadArea">
                    <div class="file-upload-content">
                        <div class="file-upload-icon">ğŸ“</div>
                        <div class="file-upload-text">é»æ“Šæˆ–æ‹–æ‹½å½±ç‰‡æª”æ¡ˆåˆ°æ­¤è™•</div>
                        <div class="file-upload-hint">æ”¯æŒ MP4ã€AVIã€MOVã€WEBM æ ¼å¼ï¼Œå»ºè­°å¤§å°ä¸è¶…é 100MB</div>
                    </div>
                </div>
                <input type="file" 
                       name="recording_file" 
                       id="recordingFile" 
                       class="hidden-file-input"
                       accept="video/mp4,video/avi,video/mov,video/webm"
                       required>
                <div id="selectedFile" class="selected-file" style="display: none;"></div>
                
                <div class="progress-container" id="progressContainer">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-text" id="progressText">æº–å‚™ä¸Šå‚³...</div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">éš±ç§è¨­å®š *</label>
                <div class="privacy-options">
                    <div class="privacy-option">
                        <input type="radio" name="privacy_setting" id="privacyPublic" value="public" required>
                        <label for="privacyPublic" class="privacy-label">
                            <div class="privacy-icon">ğŸŒ</div>
                            <div class="privacy-info">
                                <div class="privacy-title">å…¬é–‹</div>
                                <div class="privacy-desc">æ‰€æœ‰äººéƒ½å¯ä»¥è§€çœ‹æ­¤å½±ç‰‡</div>
                            </div>
                        </label>
                    </div>
                    
                    <div class="privacy-option">
                        <input type="radio" name="privacy_setting" id="privacyTeacher" value="teacher_only" required>
                        <label for="privacyTeacher" class="privacy-label">
                            <div class="privacy-icon">ğŸ‘¨â€ğŸ«</div>
                            <div class="privacy-info">
                                <div class="privacy-title">åƒ…æ•™å¸«å¯è¦‹</div>
                                <div class="privacy-desc">åªæœ‰æ‚¨çš„è€å¸«å¯ä»¥è§€çœ‹å’Œå›é¥‹</div>
                            </div>
                        </label>
                    </div>
                    
                    <div class="privacy-option">
                        <input type="radio" name="privacy_setting" id="privacyPrivate" value="private" required>
                        <label for="privacyPrivate" class="privacy-label">
                            <div class="privacy-icon">ğŸ”’</div>
                            <div class="privacy-info">
                                <div class="privacy-title">ç§äºº</div>
                                <div class="privacy-desc">åªæœ‰æ‚¨æœ¬äººå¯ä»¥è§€çœ‹</div>
                            </div>
                        </label>
                    </div>
                </div>
                <div class="form-text">é¸æ“‡èª°å¯ä»¥è§€çœ‹æ‚¨çš„æ¼”å¥å½±ç‰‡</div>
            </div>

            <div class="form-group">
                <label class="form-label">è‡ªæˆ‘è©•åˆ† *</label>
                <div class="rating-container">
                    <div class="star-rating">
                        {% for i in "12345" %}
                            <span class="star" data-rating="{{ forloop.counter }}">â˜…</span>
                        {% endfor %}
                    </div>
                    <div class="rating-display">
                        <span id="ratingValue">0</span> / 5
                    </div>
                </div>
                <input type="hidden" id="selfRating" name="self_rating" required>
                <div class="form-text">å°é€™æ¬¡æ¼”å¥çš„æ•´é«”æ»¿æ„åº¦ï¼ˆ1-5åˆ†ï¼‰</div>
            </div>

            <div class="form-group">
                <label for="notes" class="form-label">ç·´ç¿’ç­†è¨˜</label>
                <textarea name="notes" 
                          id="notes"
                          class="form-control" 
                          rows="4" 
                          placeholder="è¨˜éŒ„é€™æ¬¡æ¼”å¥çš„æ„Ÿå—ã€æŠ€å·§é‡é»ã€éœ€è¦æ”¹é€²çš„åœ°æ–¹æˆ–å¿ƒå¾—..." 
                          maxlength="1000"></textarea>
                <div class="form-text">è©³ç´°è¨˜éŒ„æ¼”å¥å…§å®¹å’Œæ„Ÿå—</div>
            </div>

            <button type="submit" class="btn-upload" id="uploadBtn">
                <span id="uploadBtnText">
                    <i class="fas fa-cloud-upload-alt me-2"></i>
                    ä¸Šå‚³å½±ç‰‡ âœ¨
                </span>
                <span id="uploadSpinner" class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
            </button>
        </form>

        <div class="upload-tips">
            <h5><i class="fas fa-lightbulb me-2"></i>ä¸Šå‚³å°è²¼å£«</h5>
            <ul>
                <li>ç‚ºäº†ç²å¾—æœ€ä½³æ•ˆæœï¼Œå»ºè­°åœ¨å…‰ç·šå……è¶³çš„ç’°å¢ƒä¸‹éŒ„è£½</li>
                <li>éŒ„è£½æ™‚ä¿æŒç©©å®šï¼Œé¿å…éåº¦æ™ƒå‹•</li>
                <li>ç¢ºä¿éŸ³è³ªæ¸…æ™°ï¼Œé¿å…èƒŒæ™¯å™ªéŸ³å¹²æ“¾</li>
                <li>å»ºè­°å½±ç‰‡é•·åº¦æ§åˆ¶åœ¨3-10åˆ†é˜ä¹‹é–“</li>
                <li>ä¸Šå‚³å®Œæˆå¾Œå¯ä»¥æ·»åŠ æ™‚é–“æ¨™è¨˜å’Œè©•è«–</li>
            </ul>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const fileUploadArea = document.getElementById('fileUploadArea');
    const fileInput = document.getElementById('recordingFile');
    const selectedFileDiv = document.getElementById('selectedFile');
    const progressContainer = document.getElementById('progressContainer');
    const progressFill = document.getElementById('progressFill');
    const progressText = document.getElementById('progressText');
    const uploadForm = document.getElementById('videoUploadForm');
    const uploadBtn = document.getElementById('uploadBtn');
    const uploadBtnText = document.getElementById('uploadBtnText');
    const uploadSpinner = document.getElementById('uploadSpinner');
    
    // æª”æ¡ˆä¸Šå‚³å€åŸŸé»æ“Šäº‹ä»¶
    fileUploadArea.addEventListener('click', () => {
        fileInput.click();
    });
    
    // æ‹–æ‹½äº‹ä»¶
    fileUploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        fileUploadArea.classList.add('dragover');
    });
    
    fileUploadArea.addEventListener('dragleave', () => {
        fileUploadArea.classList.remove('dragover');
    });
    
    fileUploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        fileUploadArea.classList.remove('dragover');
        
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            fileInput.files = files;
            handleFileSelect(files[0]);
        }
    });
    
    // æª”æ¡ˆé¸æ“‡äº‹ä»¶
    fileInput.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
            handleFileSelect(e.target.files[0]);
        }
    });
    
    function handleFileSelect(file) {
        // æª¢æŸ¥æª”æ¡ˆé¡å‹
        const allowedTypes = ['video/mp4', 'video/avi', 'video/mov', 'video/webm'];
        if (!allowedTypes.includes(file.type) && !file.name.match(/\.(mp4|avi|mov|webm)$/i)) {
            showAlert('è«‹é¸æ“‡æœ‰æ•ˆçš„å½±ç‰‡æª”æ¡ˆæ ¼å¼ï¼ˆMP4ã€AVIã€MOVã€WEBMï¼‰', 'danger');
            return;
        }
        
        // æª¢æŸ¥æª”æ¡ˆå¤§å° (100MB)
        if (file.size > 100 * 1024 * 1024) {
            showAlert('æª”æ¡ˆå¤§å°ä¸èƒ½è¶…é 100MB', 'danger');
            return;
        }
        
        // é¡¯ç¤ºé¸ä¸­çš„æª”æ¡ˆ
        selectedFileDiv.innerHTML = `
            <i class="fas fa-file-video me-2"></i>
            å·²é¸æ“‡ï¼š${file.name} (${formatFileSize(file.size)})
        `;
        selectedFileDiv.style.display = 'block';
        
        // æ›´æ–°ä¸Šå‚³å€åŸŸæ¨£å¼
        fileUploadArea.innerHTML = `
            <div class="file-upload-content">
                <div class="file-upload-icon">âœ…</div>
                <div class="file-upload-text">æª”æ¡ˆå·²é¸æ“‡</div>
                <div class="file-upload-hint">é»æ“Šé‡æ–°é¸æ“‡æª”æ¡ˆ</div>
            </div>
        `;
    }
    
    // æ˜Ÿç´šè©•åˆ†åŠŸèƒ½
    const stars = document.querySelectorAll('.star');
    const ratingInput = document.getElementById('selfRating');
    const ratingValue = document.getElementById('ratingValue');
    
    stars.forEach((star, index) => {
        star.addEventListener('click', function() {
            const rating = index + 1;
            ratingInput.value = rating;
            ratingValue.textContent = rating;
            
            // æ›´æ–°æ˜Ÿæ˜Ÿé¡¯ç¤º
            stars.forEach((s, i) => {
                if (i < rating) {
                    s.classList.add('active');
                } else {
                    s.classList.remove('active');
                }
            });
        });
        
        star.addEventListener('mouseenter', function() {
            const rating = index + 1;
            stars.forEach((s, i) => {
                if (i < rating) {
                    s.style.color = '#ffc107';
                } else {
                    s.style.color = '#ddd';
                }
            });
        });
    });
    
    document.querySelector('.star-rating').addEventListener('mouseleave', function() {
        const currentRating = parseInt(ratingInput.value) || 0;
        stars.forEach((s, i) => {
            if (i < currentRating) {
                s.style.color = '#ffc107';
                s.classList.add('active');
            } else {
                s.style.color = '#ddd';
                s.classList.remove('active');
            }
        });
    });
    
    // è¡¨å–®æäº¤è™•ç†
    uploadForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        // è¡¨å–®é©—è­‰
        if (!validateForm()) {
            return;
        }
        
        const formData = new FormData(uploadForm);
        
        // é¡¯ç¤ºé€²åº¦æ¢å’Œç¦ç”¨æŒ‰éˆ•
        progressContainer.style.display = 'block';
        uploadBtn.disabled = true;
        uploadBtnText.classList.add('d-none');
        uploadSpinner.classList.remove('d-none');
        
        try {
            const xhr = new XMLHttpRequest();
            
            // ä¸Šå‚³é€²åº¦äº‹ä»¶
            xhr.upload.addEventListener('progress', function(e) {
                if (e.lengthComputable) {
                    const percentComplete = (e.loaded / e.total) * 100;
                    progressFill.style.width = percentComplete + '%';
                    progressText.textContent = `ä¸Šå‚³ä¸­... ${Math.round(percentComplete)}%`;
                }
            });
            
            // å®Œæˆäº‹ä»¶
            xhr.addEventListener('load', function() {
                if (xhr.status === 200) {
                    const response = JSON.parse(xhr.responseText);
                    if (response.success) {
                        showAlert('å½±ç‰‡ä¸Šå‚³æˆåŠŸï¼å³å°‡è·³è½‰åˆ°å½±ç‰‡åº«...', 'success');
                        setTimeout(() => {
                            window.location.href = '{% url "practice_logs:video_library" %}';
                        }, 2000);
                    } else {
                        showAlert(response.error || 'ä¸Šå‚³å¤±æ•—', 'danger');
                        resetUploadState();
                    }
                } else {
                    showAlert('ä¸Šå‚³å¤±æ•—ï¼Œè«‹ç¨å¾Œé‡è©¦', 'danger');
                    resetUploadState();
                }
            });
            
            // éŒ¯èª¤äº‹ä»¶
            xhr.addEventListener('error', function() {
                showAlert('ç¶²è·¯éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥é€£æ¥å¾Œé‡è©¦', 'danger');
                resetUploadState();
            });
            
            // ç™¼é€è«‹æ±‚
            xhr.open('POST', '', true);
            xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
            xhr.send(formData);
            
        } catch (error) {
            showAlert('ä¸Šå‚³éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤', 'danger');
            resetUploadState();
        }
    });
    
    function validateForm() {
        const studentName = document.getElementById('studentName').value.trim();
        const piece = document.getElementById('piece').value.trim();
        const recordingDate = document.getElementById('recordingDate').value;
        const privacySetting = document.querySelector('input[name="privacy_setting"]:checked');
        const rating = document.getElementById('selfRating').value;
        const file = document.getElementById('recordingFile').files[0];
        
        if (!studentName) {
            showAlert('è«‹å¡«å¯«å­¸ç”Ÿå§“å', 'danger');
            return false;
        }
        
        if (!piece) {
            showAlert('è«‹å¡«å¯«æ¼”å¥æ›²ç›®', 'danger');
            return false;
        }
        
        if (!recordingDate) {
            showAlert('è«‹é¸æ“‡éŒ„éŸ³æ—¥æœŸ', 'danger');
            return false;
        }
        
        if (!privacySetting) {
            showAlert('è«‹é¸æ“‡éš±ç§è¨­å®š', 'danger');
            return false;
        }
        
        if (!rating || rating < 1 || rating > 5) {
            showAlert('è«‹é¸æ“‡è‡ªæˆ‘è©•åˆ†ï¼ˆ1-5åˆ†ï¼‰', 'danger');
            return false;
        }
        
        if (!file) {
            showAlert('è«‹é¸æ“‡è¦ä¸Šå‚³çš„å½±ç‰‡æª”æ¡ˆ', 'danger');
            return false;
        }
        
        return true;
    }
    
    function resetUploadState() {
        progressContainer.style.display = 'none';
        uploadBtn.disabled = false;
        uploadBtnText.classList.remove('d-none');
        uploadSpinner.classList.add('d-none');
        progressFill.style.width = '0%';
        progressText.textContent = 'æº–å‚™ä¸Šå‚³...';
    }
    
    function showAlert(message, type) {
        const alertContainer = document.getElementById('alertContainer');
        const alert = document.createElement('div');
        alert.className = `alert alert-${type} alert-dismissible fade show`;
        alert.innerHTML = `
            <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-triangle'} me-2"></i>
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        `;
        alertContainer.appendChild(alert);
        
        // 3ç§’å¾Œè‡ªå‹•é—œé–‰
        setTimeout(() => {
            alert.remove();
        }, 5000);
    }
    
    function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
    
    // è¨­ç½®é»˜èªæ—¥æœŸç‚ºä»Šå¤©
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('recordingDate').value = today;
});
</script>
{% endblock %}